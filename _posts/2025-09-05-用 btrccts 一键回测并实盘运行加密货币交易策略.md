---
layout:     post
title:      ç”¨ btrccts ä¸€é”®å›žæµ‹å¹¶å®žç›˜è¿è¡ŒåŠ å¯†è´§å¸äº¤æ˜“ç­–ç•¥
date:       2025-09-05
header-img: img/post-bg-desk.jpg
catalog: true
---

> å…³é”®è¯ï¼šbtrcctsã€åŠ å¯†è´§å¸ç­–ç•¥å›žæµ‹ã€é‡åŒ–äº¤æ˜“æ¡†æž¶ã€CCXTã€Python é‡åŒ–ã€ç­–ç•¥å®žç›˜ã€åŠ å¯†è´§å¸å›žæµ‹å¼•æ“Žã€Kraken APIã€äº¤æ˜“æ‰€æ¨¡æ‹Ÿæ’®åˆ

æƒ³åœ¨æœ¬åœ°**ä½Žæˆæœ¬**åœ°å®ŒæˆåŠ å¯†è´§å¸ç­–ç•¥çš„**å›žæµ‹ä¸Žå®žç›˜åˆ‡æ¢**ï¼Ÿå¼€æºåº“ `btrccts` å€ŸåŠ© **CCXT** æ ‡å‡†æŽ¥å£ï¼Œå°†åŽ†å²è¡Œæƒ…å›žæ”¾ä¸Žå®žæ—¶æ’®åˆæ— ç¼è¿žæŽ¥ï¼Œå¸®ä½ ä¸“æ³¨ç­–ç•¥æœ¬èº«ã€‚ä¸‹æ–‡å¸¦ä½ ä»Žå®‰è£…ã€æ•°æ®å‡†å¤‡åˆ°å®žç›˜éƒ¨ç½²ä¸€æ¬¡æ‰“é€šã€‚

---

## 1. å®‰è£…ä¸Žå¼€å‘çŽ¯å¢ƒ

æœ€ç®€ Python 3 å®‰è£…ï¼ˆå·²æ”¯æŒ Linux/macOS/Windowsï¼‰ï¼š

```bash
python3 -m venv .venv
source .venv/bin/activate
pip install btrccts
```

è‹¥éœ€äºŒæ¬¡å¼€å‘ï¼Œå¯ç›´æŽ¥æºç å®‰è£…ï¼š

```bash
git clone https://github.com/btrccts/btrccts.git
cd btrccts
pip install -r requirements.txt
pip install -e .
```

ðŸ‘‰ [ç«‹å³ä¸Šæ‰‹ btrcctsï¼š5 åˆ†é’Ÿå®Œæˆå…¬æµ‹å¹¶å¯¹æ¯”ç›ˆäº](https://okxdog.com/)

---

## 2. ä¸€æ¡å‘½ä»¤è·‘èµ·å›žæµ‹

`btrccts` å°†ç­–ç•¥æ‰§è¡Œæµç¨‹æŠ½è±¡æˆå››ä¸ªé˜¶æ®µï¼š

| é˜¶æ®µ | ä½œç”¨ | btrccts é£Žæ ¼ |
|---|---|---|
| åˆå§‹åŒ– | è§£æžå‚æ•°ã€å»ºç«‹äº¤æ˜“æ‰€å¯¹è±¡ | `__init__` |
| æ¯ä¸€ tick | æ‰§è¡Œä¹°å–é€»è¾‘ | `next_iteration` |
| å¼‚å¸¸å¤„ç† | ç½‘ç»œã€API å¼‚å¸¸é‡è¯•æˆ–æŠ¥è­¦ | `handle_exception` |
| ç»“æŸæ¸…ç† | æŒ‚å•æ’¤é”€ã€æ—¥å¿—å¯¼å‡º | `exit` |

èŒƒä¾‹ï¼šå®šä¹‰**è¿½è¸ª 10 åˆ†é’Ÿå‡çº¿**çš„æžç®€ç­–ç•¥

```python
from btrccts import AlgorithmBase, parse_params_and_execute_algorithm

class MyMA(AlgorithmBase):
    def __init__(self, context, args):
        self.ex = context.create_exchange('kraken', async_ccxt=True)
        self.short = args.short
        self.long = args.long

    async def next_iteration(self):
        await self.ex.load_markets()
        candles = await self.ex.fetch_ohlcv('BTC/USD', '1m', limit=self.long)
        close = [c[4] for c in candles]
        ma_short = sum(close[-self.short:]) / self.short
        ma_long  = sum(close[-self.long:])  / self.long
        if ma_short > ma_long:
            await self.ex.create_order('BTC/USD', 'market', 'buy', 0.01)
        elif ma_short < ma_long:
            await self.ex.create_order('BTC/USD', 'market', 'sell', 0.01)

parse_params_and_execute_algorithm(MyMA)
```

ä¿å­˜åŽä¸€è¡Œå¯åŠ¨å›žæµ‹ï¼š

```bash
python ma_strategy.py \
  --start-date 2024-01-01 --end-date 2024-06-01 \
  --interval 1m --exchanges kraken --symbols BTC/USD \
  --start-balances '{"kraken":{"USD":10000}}' \
  --short 5 --long 30
```

---

## 3. æ•°æ®ç›®å½•è§„èŒƒ

`btrccts` è‡ªå¸¦â€œè™šæ‹Ÿäº¤æ˜“æ‰€â€ï¼Œä¸ä¼šæŠ“å–ä»»ä½•å®žæ—¶è¡Œæƒ…ï¼›ä½ éœ€è¦æå‰å‡†å¤‡ **1 åˆ†é’Ÿç²’åº¦ OHLCV** CSVï¼Œé»˜è®¤å­˜æ”¾è·¯å¾„ï¼š

```
data/ohlcv/EXCHANGE/BASE/QUOTE.csv
```

ç¤ºä¾‹æ–‡ä»¶ç‰‡æ®µï¼š

```
,open,high,low,close,volume
2024-05-28 08:00:00+00:00,68500,68600,68400,68550,1200
2024-05-28 08:01:00+00:00,68550,68700,68520,68680,1400
```

ç¬”è®°ï¼šæ•°æ®å¿…é¡»è¦†ç›–å›žæµ‹èµ·æ­¢æ—¥æœŸï¼Œå¹¶ä¿è¯**æ— ç¼ºå¤±**ï¼Œå¦åˆ™ä¼šåœ¨å›žæµ‹é˜¶æ®µæŠ¥é”™ã€‚

---

## 4. å®žç›˜æ¨¡å¼ä»…éœ€ä¸€ä¸ªå¼€å…³

åˆ‡æ¢åˆ°å®žç›˜ï¼Œä»…éœ€è¿½åŠ  `--live`ï¼š

```bash
python ma_strategy.py --live
```

å®žç›˜æ³¨æ„äº‹é¡¹ï¼š

1. åœ¨ `config/kraken.json` å­˜æ”¾çœŸå®ž API Keyï¼š  
   ```
   {"apiKey":"your_key","secret":"your_secret"}
   ```
2. åº“**ä¸ä¼šè‡ªåŠ¨åŠ è½½ markets**ï¼Œå»ºè®®ä½ é¦–æ¬¡è¿žæŽ¥æ—¶æ‰‹åŠ¨ `load_markets()`ã€‚
3. `btrccts` å¯¹å¼‚å¸¸åšäº†é»˜è®¤éš”ç¦»ï¼Œç”Ÿäº§çŽ¯å¢ƒå¯åœ¨ `handle_exception` å†…æŽ¥å…¥é’‰é’‰ã€Slackã€é‚®ç®±ç­‰å‘Šè­¦é€šé“ã€‚

---

## 5. æ’®åˆæœºåˆ¶æ·±åº¦è§£è¯»

äº†è§£ç»†èŠ‚å¯é¿å…è¿‡åº¦æ‹Ÿåˆã€‚

### 5.1 å¸‚ä»·å•æ’®åˆ

- å›žæº¯é˜¶æ®µï¼šä½¿ç”¨å½“å‰ K çº¿çš„ **æœ€é«˜/æœ€ä½Žä»·** æˆäº¤ï¼Œé˜²æ­¢æœªæ¥å‡½æ•°ï¼Œä½†ä»**ç«‹å³æˆäº¤**ã€‚
- å®žç›˜ï¼šç›´æŽ¥äº¤ç”±äº¤æ˜“æ‰€æ’®åˆï¼Œä¸Žå›žæµ‹é€»è¾‘ä¸€è‡´ã€‚

### 5.2 é™ä»·å•

- å›žæµ‹æ—¶ï¼Œåªè¦ä»·æ ¼è§¦åŠé™ä»·å³ **ä¸€æ¬¡æ€§å…¨éƒ¨æˆäº¤**ï¼Œæš‚æ—¶ä¸æ”¯æŒåˆ†æ‰¹æˆäº¤æ¨¡æ‹Ÿã€‚  
- æŒ‚å•é‡å¤§ã€æ·±åº¦è–„æ—¶åº”è‡ªè¡ŒåŠ å…¥æ»‘ç‚¹æ¨¡åž‹ã€‚

---

## 6. é«˜é¢‘åœºæ™¯ vs ä½Žé¢‘ç­–ç•¥æ—¶é—´æŽ§åˆ¶

- å›žæµ‹ï¼šæŒ‰æ‚¨æŒ‡å®šçš„ `--interval` æŽ¨è¿›æ—¶é’Ÿï¼Œå›ºå®šèŠ‚å¥ã€‚
- å®žç›˜ï¼šé¦–æ¬¡è¿è¡ŒåŽç«‹åˆ»è§¦å‘ `next_iteration`ï¼ŒéšåŽæŒ‰è¯¥é—´éš”å¾ªçŽ¯ã€‚è‹¥æœ¬æ¬¡æ‰§è¡Œè€—æ—¶è¶…è¿‡ intervalï¼Œåˆ™**ç«‹å³è¡¥å‘**ä¸‹ä¸€æ¬¡ï¼Œé˜²æ­¢æ¼å•ã€‚

---

## 7. FAQï¼ˆé«˜é¢‘é—®é¢˜é€ŸæŸ¥ï¼‰

**Q1ï¼šå¯ä»¥å°† OKX çš„ API ç›´æŽ¥å¯¹æŽ¥å—ï¼Ÿ**  
Aï¼šå¯ä»¥ï¼ŒOKX åœ¨ CCXT ä¸­æ ‡è¯†ä¸º `okx`ï¼Œåªéœ€åœ¨ç­–ç•¥å‚æ•°é‡Œä¼ å…¥å³å¯ã€‚  
ðŸ‘‰ [æŸ¥çœ‹ OKX API æ–‡æ¡£ä¸Žç¤ºä¾‹](https://okxdog.com/)

**Q2ï¼šå¦‚ä½•æŽ¥å…¥è‡ªå®šä¹‰æŒ‡æ ‡åº“ï¼Ÿ**  
Aï¼š`next_iteration` å®Œå…¨ç”±ä½ æŽŒæŽ§ï¼Œå¯è°ƒç”¨ `pandas-ta`ã€`talib`ã€`bt` ç­‰ä»»ä½•æŒ‡æ ‡åº“ã€‚

**Q3ï¼šèƒ½å¦å¤šäº¤æ˜“æ‰€åŒæ—¶å›žæµ‹ï¼Ÿ**  
Aï¼šè°ƒç”¨ `context.create_exchange()` ä»»æ„æ¬¡æ•°å³å¯ã€‚æ•°æ®æºéœ€ä¸º `data/ohlcv/` ä¸‹å¯¹åº”å­ç›®å½• CSVã€‚

**Q4ï¼šå®žç›˜æ—¶å»¶è¿Ÿæœ‰å¤šå¤§ï¼Ÿ**  
Aï¼šå–å†³äºŽäº¤æ˜“æ‰€ REST / WebSocket å»¶è¿Ÿã€æœ¬åœ°ç½‘ç»œåŠç­–ç•¥æœ¬èº«è€—æ—¶ï¼›å¯åœ¨ log ä¸­æ‰“å° `time.time()` è‡ªè¡Œè¯„ä¼°ã€‚

**Q5ï¼šå®˜ç½‘ç¤ºä¾‹å¤ªç®€å•ï¼Œå¦‚ä½•æ‰©å±•ä¸ºå¤šèµ„äº§å¤šå‘¨æœŸï¼Ÿ**  
Aï¼š  
- å‚æ•°ç”¨ `--symbols BTC/USD,ETH/USD --intervals 1m,5m,15m` ä¼ å…¥ï¼›  
- åœ¨ç­–ç•¥å†…ç”¨ `asyncio.gather()` å¹¶è¡Œå¹¶è¡Œæ‹‰å–è¡Œæƒ…ã€æŽ¨é€ä¿¡å·ã€‚  
- å»ºè®®æ‹†åˆ†å­ç­–ç•¥ç±»ï¼Œé™ä½Žå•æ–‡ä»¶å¤æ‚åº¦ã€‚

---

## 8. æ‰©å±•é˜…è¯»ä¸Žç¤¾åŒº

- æºç ä»“åº“ï¼šhttps://github.com/btrccts/btrccts